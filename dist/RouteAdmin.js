(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["RouteAdmin"],{

/***/ "./src/img/adminbg.jpeg":
/*!******************************!*\
  !*** ./src/img/adminbg.jpeg ***!
  \******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony default export */ __webpack_exports__[\"default\"] = (__webpack_require__.p + \"src/img/adminbg.jpeg\");\n\n//# sourceURL=webpack:///./src/img/adminbg.jpeg?");

/***/ }),

/***/ "./src/page/Admin/Admin.tsx":
/*!**********************************!*\
  !*** ./src/page/Admin/Admin.tsx ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var socket_io_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! socket.io-client */ \"./node_modules/socket.io-client/lib/index.js\");\n/* harmony import */ var socket_io_client__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(socket_io_client__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var react_loadable__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react-loadable */ \"./node_modules/react-loadable/lib/index.js\");\n/* harmony import */ var react_loadable__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(react_loadable__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _material_ui_styles__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @material-ui/styles */ \"./node_modules/@material-ui/styles/esm/index.js\");\n/* harmony import */ var _AppContext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../AppContext */ \"./src/AppContext.tsx\");\n/* harmony import */ var _img_adminbg_jpeg__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../img/adminbg.jpeg */ \"./src/img/adminbg.jpeg\");\n\r\n\r\n\r\n\r\n\r\n\r\nconst AdminLogin = react_loadable__WEBPACK_IMPORTED_MODULE_2___default()({\r\n    loader: () => __webpack_require__.e(/*! import() | AdminLogin */ \"AdminLogin\").then(__webpack_require__.bind(null, /*! ./AdminLogin */ \"./src/page/Admin/AdminLogin.tsx\")),\r\n    loading: () => null\r\n});\r\nconst Dashboard = react_loadable__WEBPACK_IMPORTED_MODULE_2___default()({\r\n    loader: () => Promise.all(/*! import() | Dashboard */[__webpack_require__.e(\"vendors~Dashboard\"), __webpack_require__.e(\"Dashboard\")]).then(__webpack_require__.bind(null, /*! ./Dashboard */ \"./src/page/Admin/Dashboard.tsx\")),\r\n    loading: () => null\r\n});\r\nconst AdminBackdrop = react_loadable__WEBPACK_IMPORTED_MODULE_2___default()({\r\n    loader: () => __webpack_require__.e(/*! import() | AdminBackdrop */ \"AdminBackdrop\").then(__webpack_require__.bind(null, /*! ./AdminBackdrop */ \"./src/page/Admin/AdminBackdrop.tsx\")),\r\n    loading: () => null\r\n});\r\nconst useStyles = Object(_material_ui_styles__WEBPACK_IMPORTED_MODULE_3__[\"makeStyles\"])(theme => ({}));\r\nconst Admin = () => {\r\n    const classes = useStyles();\r\n    const { csrf, setCsrf, enQSnackbar, closeSnackbar, _xhrPost, _xhrGet, _onLocalhost } = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useContext\"])(_AppContext__WEBPACK_IMPORTED_MODULE_4__[\"AppContext\"]);\r\n    const [sess, setSess] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useState\"])(null);\r\n    const [notifications, setNotifications] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useState\"])(null);\r\n    const [notiPage, setNotiPage] = react__WEBPACK_IMPORTED_MODULE_0___default.a.useState(0);\r\n    const passingProps = {\r\n        ...Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useContext\"])(_AppContext__WEBPACK_IMPORTED_MODULE_4__[\"AppContext\"]),\r\n        sess,\r\n        getSess,\r\n        ic_bg: _img_adminbg_jpeg__WEBPACK_IMPORTED_MODULE_5__[\"default\"],\r\n        handleLogout,\r\n        notifications,\r\n        setNotifications,\r\n        notiPage,\r\n        setNotiPage,\r\n        realtimeAccess,\r\n        realtimeTopupAccept,\r\n        realtimeEndOfSale\r\n    };\r\n    async function handleLogout() {\r\n        const res = await _xhrGet(\"logout\");\r\n        setCsrf(res.csrf);\r\n        console.log(res.data);\r\n        getSess();\r\n    }\r\n    async function getSess() {\r\n        const res = await _xhrGet(\"asession\");\r\n        setCsrf(res.csrf);\r\n        console.log(res.data);\r\n        if (res.data.status === \"not member\") {\r\n            handleLogout();\r\n        }\r\n        else {\r\n            setSess(res.data);\r\n            getNotifications(res.data);\r\n        }\r\n    }\r\n    async function getNotifications(thisSess) {\r\n        const res = await _xhrPost({\r\n            csrf,\r\n            url: \"aloadusersystem\",\r\n            body: {\r\n                action: \"noti\",\r\n                adminid: thisSess.userId,\r\n                startindex: 0,\r\n                lastindex: (notiPage + 1) * 10\r\n            }\r\n        });\r\n        setCsrf(res.csrf);\r\n        console.log(res.data);\r\n        setNotifications(res.data);\r\n    }\r\n    function realtimeAccess() {\r\n        const socket = socket_io_client__WEBPACK_IMPORTED_MODULE_1___default()(\"https://easyrecycle.ml\", {\r\n            transports: [\"websocket\", \"polling\"]\r\n        });\r\n        socket.emit(\"noti\", {\r\n            action: \"noti\",\r\n            linetoken: sess && sess.userid,\r\n            type: sess.type,\r\n            startindex: 0,\r\n            lastindex: (notiPage + 1) * 10\r\n        });\r\n    }\r\n    function realtimeTopupAccept(detail) {\r\n        const socket = socket_io_client__WEBPACK_IMPORTED_MODULE_1___default()(\"https://easyrecycle.ml\", {\r\n            transports: [\"websocket\", \"polling\"]\r\n        });\r\n        const { linetoken } = detail;\r\n        socket.emit(\"noti\", {\r\n            action: \"noti\",\r\n            linetoken,\r\n            type: \"customer\",\r\n            startindex: 0,\r\n            lastindex: (notiPage + 1) * 10\r\n        });\r\n    }\r\n    function realtimeEndOfSale(detail) {\r\n        const socket = socket_io_client__WEBPACK_IMPORTED_MODULE_1___default()(\"https://easyrecycle.ml\", {\r\n            transports: [\"websocket\", \"polling\"]\r\n        });\r\n        const { linetoken } = detail;\r\n        console.log({\r\n            action: \"noti\",\r\n            linetoken,\r\n            type: \"business\",\r\n            startindex: 0,\r\n            lastindex: (notiPage + 1) * 10\r\n        });\r\n        socket.emit(\"noti\", {\r\n            action: \"noti\",\r\n            linetoken,\r\n            type: \"business\",\r\n            startindex: 0,\r\n            lastindex: (notiPage + 1) * 10\r\n        });\r\n    }\r\n    function realtimeNoti() {\r\n        const socket = socket_io_client__WEBPACK_IMPORTED_MODULE_1___default()(\"https://easyrecycle.ml\", {\r\n            transports: [\"websocket\", \"polling\"]\r\n        });\r\n        socket.on(`noti-${sess.userid}`, (messageNew) => {\r\n            if (messageNew) {\r\n                console.log(messageNew);\r\n            }\r\n        });\r\n    }\r\n    Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useEffect\"])(() => {\r\n        if (sess && sess.status !== \"not member\") {\r\n            realtimeNoti();\r\n            getNotifications(sess);\r\n        }\r\n    }, [sess, notiPage]);\r\n    Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useEffect\"])(() => {\r\n        getSess();\r\n    }, []);\r\n    return (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_AppContext__WEBPACK_IMPORTED_MODULE_4__[\"AppContext\"].Provider, { value: passingProps },\r\n        react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(\"div\", null, _onLocalhost(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Dashboard, null), sess ? (sess.status === \"need login before\" ? (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(AdminLogin, null)) : (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Dashboard, null))) : (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(AdminBackdrop, null))))));\r\n};\r\n/* harmony default export */ __webpack_exports__[\"default\"] = (Admin);\r\n\n\n//# sourceURL=webpack:///./src/page/Admin/Admin.tsx?");

/***/ }),

/***/ 0:
/*!********************!*\
  !*** ws (ignored) ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/* (ignored) */\n\n//# sourceURL=webpack:///ws_(ignored)?");

/***/ })

}]);