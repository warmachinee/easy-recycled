(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["RouteBusiness"],{

/***/ "./src/page/Business/Business.tsx":
/*!****************************************!*\
  !*** ./src/page/Business/Business.tsx ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var socket_io_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! socket.io-client */ \"./node_modules/socket.io-client/lib/index.js\");\n/* harmony import */ var socket_io_client__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(socket_io_client__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _material_ui_styles__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @material-ui/styles */ \"./node_modules/@material-ui/styles/esm/index.js\");\n/* harmony import */ var _AppContext__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../AppContext */ \"./src/AppContext.tsx\");\n/* harmony import */ var react_loadable__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! react-loadable */ \"./node_modules/react-loadable/lib/index.js\");\n/* harmony import */ var react_loadable__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(react_loadable__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @material-ui/core */ \"./node_modules/@material-ui/core/esm/index.js\");\n/* harmony import */ var _material_ui_icons__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @material-ui/icons */ \"./node_modules/@material-ui/icons/esm/index.js\");\n/* harmony import */ var react_router_dom__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! react-router-dom */ \"./node_modules/react-router-dom/esm/react-router-dom.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst useStyles = Object(_material_ui_styles__WEBPACK_IMPORTED_MODULE_2__[\"makeStyles\"])((theme) => ({}));\r\nconst liff = window.liff;\r\nconst Header = react_loadable__WEBPACK_IMPORTED_MODULE_4___default()({\r\n    loader: () => __webpack_require__.e(/*! import() | Header */ \"Header\").then(__webpack_require__.bind(null, /*! ./Header */ \"./src/page/Business/Header.tsx\")),\r\n    loading: () => null\r\n});\r\nconst GeneralDialog = react_loadable__WEBPACK_IMPORTED_MODULE_4___default()({\r\n    loader: () => Promise.all(/*! import() | GeneralDialog */[__webpack_require__.e(\"vendors~AddFab~AdminHeader~AdminList~BusinessDetail~BusinessProfile~BusinessType~Condition~ConfirmDi~645c9302\"), __webpack_require__.e(\"GeneralDialog\")]).then(__webpack_require__.bind(null, /*! ../../component/Dialog/GeneralDialog */ \"./src/component/Dialog/GeneralDialog.tsx\")),\r\n    loading: () => null\r\n});\r\nconst NotificationsList = react_loadable__WEBPACK_IMPORTED_MODULE_4___default()({\r\n    loader: () => __webpack_require__.e(/*! import() | NotificationsList */ \"NotificationsList\").then(__webpack_require__.bind(null, /*! ../../component/Utils/NotificationsList */ \"./src/component/Utils/NotificationsList.tsx\")),\r\n    loading: () => null\r\n});\r\nconst BussinessBackdrop = react_loadable__WEBPACK_IMPORTED_MODULE_4___default()({\r\n    loader: () => __webpack_require__.e(/*! import() | BussinessBackdrop */ \"BussinessBackdrop\").then(__webpack_require__.bind(null, /*! ./BussinessBackdrop */ \"./src/page/Business/BussinessBackdrop.tsx\")),\r\n    loading: () => null\r\n});\r\nconst BusinessRegister = react_loadable__WEBPACK_IMPORTED_MODULE_4___default()({\r\n    loader: () => Promise.all(/*! import() | BusinessRegister */[__webpack_require__.e(\"vendors~BusinessDetail~BusinessProfile~BusinessRegister~CustomerRegister~UserProfile\"), __webpack_require__.e(\"BusinessRegister\")]).then(__webpack_require__.bind(null, /*! ./BusinessRegister */ \"./src/page/Business/BusinessRegister.tsx\")),\r\n    loading: () => null\r\n});\r\nconst GoodsList = react_loadable__WEBPACK_IMPORTED_MODULE_4___default()({\r\n    loader: () => Promise.all(/*! import() | GoodsList */[__webpack_require__.e(\"vendors~AddFab~AdminHeader~AdminList~BusinessDetail~BusinessProfile~BusinessType~Condition~ConfirmDi~645c9302\"), __webpack_require__.e(\"vendors~BusinessList~CustomerList~GoodsList~Topup\"), __webpack_require__.e(\"GoodsList\")]).then(__webpack_require__.bind(null, /*! ./GoodsList */ \"./src/page/Business/GoodsList.tsx\")),\r\n    loading: () => null\r\n});\r\nconst Business = ({ location, history, match }) => {\r\n    const classes = useStyles();\r\n    const { csrf, setCsrf, setDense, enQSnackbar, closeSnackbar, _xhrPost, _xhrGet, _onLocalhost, _onLocalhostFn, booleanReducer } = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useContext\"])(_AppContext__WEBPACK_IMPORTED_MODULE_3__[\"AppContext\"]);\r\n    const [profileData, setProfileData] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useState\"])(null);\r\n    const [sess, setSess] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useState\"])(null);\r\n    const [userInfo, setUserInfo] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useState\"])(null);\r\n    const [backDrop, setBackDrop] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useState\"])(null);\r\n    const [notifications, setNotifications] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useState\"])(null);\r\n    const [notiPage, setNotiPage] = react__WEBPACK_IMPORTED_MODULE_0___default.a.useState(0);\r\n    const [{ noti }, booleanDispatch] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useReducer\"])(booleanReducer, { noti: false });\r\n    const passingProps = {\r\n        ...Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useContext\"])(_AppContext__WEBPACK_IMPORTED_MODULE_3__[\"AppContext\"]),\r\n        sess,\r\n        getSess,\r\n        profileData,\r\n        addSnackbar,\r\n        handleLogout,\r\n        checkSession,\r\n        notifications,\r\n        setNotifications,\r\n        notiPage,\r\n        setNotiPage,\r\n        readNotifications,\r\n        userInfo,\r\n        getInfo,\r\n        booleanDispatch,\r\n        realtimeAccess,\r\n        realtimeEndOfSale\r\n    };\r\n    function getProfile() {\r\n        liff\r\n            .getProfile()\r\n            .then((profile) => {\r\n            setProfileData(profile);\r\n            getSess(profile);\r\n        })\r\n            .catch(err => console.error(err));\r\n    }\r\n    function addSnackbar({ message, variant }) {\r\n        enQSnackbar({\r\n            message,\r\n            variant,\r\n            action\r\n        });\r\n    }\r\n    function handleFetch() {\r\n        const myLiffId = \"1653861118-82Pmap5k\";\r\n        liff.init({ liffId: myLiffId }, async () => {\r\n            if (liff.isLoggedIn()) {\r\n                getProfile();\r\n            }\r\n            else {\r\n                liff.login();\r\n            }\r\n        });\r\n    }\r\n    async function getInfo() {\r\n        const res = await _xhrPost({\r\n            csrf,\r\n            url: \"loadusersystem\",\r\n            body: { action: \"info\", type: \"business\" }\r\n        });\r\n        setCsrf(res.csrf);\r\n        if (\"status\" in res.data) {\r\n            checkSession();\r\n        }\r\n        else {\r\n            setUserInfo(res.data);\r\n        }\r\n    }\r\n    async function getSess(profile) {\r\n        setSess(null);\r\n        setBackDrop(null);\r\n        const res = await _xhrPost({\r\n            csrf,\r\n            url: \"session\",\r\n            body: { linetoken: profile.userId, type: \"business\" }\r\n        });\r\n        setCsrf(res.csrf);\r\n        setSess(res.data);\r\n        setBackDrop(res.data);\r\n        if (res.data.status !== \"not member\") {\r\n            getInfo();\r\n            getNotifications(profile);\r\n        }\r\n    }\r\n    async function handleLogout() {\r\n        const res = await _xhrGet(\"logout\");\r\n        setCsrf(res.csrf);\r\n        if (liff.isLoggedIn()) {\r\n            liff.logout();\r\n        }\r\n        window.location.reload();\r\n    }\r\n    async function checkSession() {\r\n        const res = await _xhrGet(\"logout\");\r\n        setCsrf(res.csrf);\r\n        handleFetch();\r\n    }\r\n    async function getNotifications(profile) {\r\n        const res = await _xhrPost({\r\n            csrf,\r\n            url: \"loadusersystem\",\r\n            body: {\r\n                action: \"noti\",\r\n                linetoken: profile.userId,\r\n                type: \"business\",\r\n                startindex: 0,\r\n                lastindex: (notiPage + 1) * 10\r\n            }\r\n        });\r\n        setCsrf(res.csrf);\r\n        console.log(res.data);\r\n        if (\"status\" in res.data &&\r\n            res.data.status === \"this is not user account or have been delete account\") {\r\n            checkSession();\r\n        }\r\n        else {\r\n            setNotifications(res.data);\r\n        }\r\n    }\r\n    async function readNotifications() {\r\n        const res = await _xhrPost({\r\n            csrf,\r\n            url: \"usersystem\",\r\n            body: {\r\n                action: \"readnoti\",\r\n                linetoken: profileData && profileData.userId,\r\n                type: \"business\"\r\n            }\r\n        });\r\n        setCsrf(res.csrf);\r\n        console.log(res.data);\r\n        getNotifications(profileData);\r\n    }\r\n    function realtimeAccess() {\r\n        const socket = socket_io_client__WEBPACK_IMPORTED_MODULE_1___default()(\"https://easyrecycle.ml\", {\r\n            transports: [\"websocket\", \"polling\"]\r\n        });\r\n        socket.emit(\"noti\", {\r\n            action: \"noti\",\r\n            linetoken: profileData && profileData.userId,\r\n            type: \"business\",\r\n            startindex: 0,\r\n            lastindex: (notiPage + 1) * 10\r\n        });\r\n    }\r\n    function realtimeEndOfSale(detail) {\r\n        const socket = socket_io_client__WEBPACK_IMPORTED_MODULE_1___default()(\"https://easyrecycle.ml\", {\r\n            transports: [\"websocket\", \"polling\"]\r\n        });\r\n        const { linetoken } = detail;\r\n        socket.emit(\"noti\", {\r\n            action: \"noti\",\r\n            linetoken,\r\n            type: \"customer\",\r\n            startindex: 0,\r\n            lastindex: (notiPage + 1) * 10\r\n        });\r\n    }\r\n    function realtimeNoti(thisSess) {\r\n        console.log(`noti-${thisSess.userid}`);\r\n        const socket = socket_io_client__WEBPACK_IMPORTED_MODULE_1___default()(\"https://easyrecycle.ml\", {\r\n            transports: [\"websocket\", \"polling\"]\r\n        });\r\n        socket.on(`noti-${thisSess.userid}`, (messageNew) => {\r\n            if (messageNew && messageNew.status === \"success\") {\r\n                const { list } = messageNew.result;\r\n                // console.log(messageNew);\r\n                setNotifications(list);\r\n            }\r\n        });\r\n    }\r\n    Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useEffect\"])(() => {\r\n        if (profileData && sess) {\r\n            realtimeNoti(sess);\r\n            getNotifications(profileData);\r\n        }\r\n    }, [sess, profileData, notiPage]);\r\n    Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useEffect\"])(() => {\r\n        setDense(true);\r\n        _onLocalhostFn(() => {\r\n            setProfileData({\r\n                userId: \"U34854b16de48d84b63c751717c9d2771\",\r\n                displayName: \"P.R.E.M.I.O.R\",\r\n                pictureUrl: \"https://profile.line-scdn.net/0hPyKQa5SXD1Z2KCciVYpwAUptATsBBgkeDh0UNVooWDJcT05USkhFY1F9AW9dEU8CShsUN1N7UmUJ\",\r\n                statusMessage: \"UI/UX Developer at PDS Co.,Ltd.\"\r\n            });\r\n            setSess({\r\n                userid: 12346,\r\n                type: \"main_admin\",\r\n                fullname: \"admin\",\r\n                lastname: \"admin\"\r\n            });\r\n            setUserInfo({\r\n                displayname: \"P.R.E.M.I.O.R\",\r\n                fullname: \"Sippakorn\",\r\n                lastname: \"Suphapinyo\",\r\n                tel: 80670057,\r\n                statusmassage: \"UI/UX Developer at PDS Co.,Ltd.\",\r\n                picture: \"https://profile.line-scdn.net/0hPyKQa5SXD1Z2KCciVYpwAUptATsBBgkeDh0UNVooWDJcT05USkhFY1F9AW9dEU8CShsUN1N7UmUJ\",\r\n                email: \"sippakorn.prem@gmail.com\"\r\n            });\r\n        }, handleFetch);\r\n    }, []);\r\n    const action = (key) => (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_material_ui_core__WEBPACK_IMPORTED_MODULE_5__[\"IconButton\"], { onClick: () => closeSnackbar(key) },\r\n        react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_material_ui_icons__WEBPACK_IMPORTED_MODULE_6__[\"Close\"], { style: { color: \"white\" } })));\r\n    return (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_AppContext__WEBPACK_IMPORTED_MODULE_3__[\"AppContext\"].Provider, { value: passingProps },\r\n        react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(\"div\", null,\r\n            react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Header, Object.assign({}, { profileData, handleLogout })),\r\n            _onLocalhost(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(GoodsList, null), react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment, null,\r\n                sess &&\r\n                    (sess.status !== \"not member\" ? (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(GoodsList, null)) : (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(BusinessRegister, Object.assign({}, { profileData })))),\r\n                react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(BussinessBackdrop, Object.assign({}, { backDrop, setBackDrop })))),\r\n            react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(GeneralDialog, { open: noti, onClose: () => booleanDispatch({ type: \"false\", key: \"noti\" }), title: \"\\u0E01\\u0E32\\u0E23\\u0E41\\u0E08\\u0E49\\u0E07\\u0E40\\u0E15\\u0E37\\u0E2D\\u0E19\", fullScreen: true, dividers: false, contentStyle: { padding: 0 } },\r\n                react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(NotificationsList, null)))));\r\n};\r\n/* harmony default export */ __webpack_exports__[\"default\"] = (Object(react_router_dom__WEBPACK_IMPORTED_MODULE_7__[\"withRouter\"])(props => react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Business, Object.assign({}, props))));\r\n\n\n//# sourceURL=webpack:///./src/page/Business/Business.tsx?");

/***/ }),

/***/ 0:
/*!********************!*\
  !*** ws (ignored) ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/* (ignored) */\n\n//# sourceURL=webpack:///ws_(ignored)?");

/***/ })

}]);