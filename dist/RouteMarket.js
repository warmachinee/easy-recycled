(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["RouteMarket"],{

/***/ "./src/page/Market/Market.tsx":
/*!************************************!*\
  !*** ./src/page/Market/Market.tsx ***!
  \************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var react_loadable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-loadable */ \"./node_modules/react-loadable/lib/index.js\");\n/* harmony import */ var react_loadable__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react_loadable__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var socket_io_client__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! socket.io-client */ \"./node_modules/socket.io-client/lib/index.js\");\n/* harmony import */ var socket_io_client__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(socket_io_client__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _material_ui_styles__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @material-ui/styles */ \"./node_modules/@material-ui/styles/esm/index.js\");\n/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @material-ui/core */ \"./node_modules/@material-ui/core/esm/index.js\");\n/* harmony import */ var _material_ui_icons__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @material-ui/icons */ \"./node_modules/@material-ui/icons/esm/index.js\");\n/* harmony import */ var _material_ui_core_colors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @material-ui/core/colors */ \"./node_modules/@material-ui/core/esm/colors/index.js\");\n/* harmony import */ var _AppContext__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../AppContext */ \"./src/AppContext.tsx\");\n/* harmony import */ var react_router_dom__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! react-router-dom */ \"./node_modules/react-router-dom/esm/react-router-dom.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst AppButton = react_loadable__WEBPACK_IMPORTED_MODULE_1___default()({\r\n    loader: () => __webpack_require__.e(/*! import() | AppButton */ \"AppButton\").then(__webpack_require__.bind(null, /*! ../../AppComponent/AppButton */ \"./src/AppComponent/AppButton.tsx\")),\r\n    loading: () => null,\r\n});\r\nconst MarketHeader = react_loadable__WEBPACK_IMPORTED_MODULE_1___default()({\r\n    loader: () => __webpack_require__.e(/*! import() | MarketHeader */ \"MarketHeader\").then(__webpack_require__.bind(null, /*! ./MarketHeader */ \"./src/page/Market/MarketHeader.tsx\")),\r\n    loading: () => null,\r\n});\r\nconst RouteMarketList = react_loadable__WEBPACK_IMPORTED_MODULE_1___default.a.Map({\r\n    loader: {\r\n        MarketList: () => __webpack_require__.e(/*! import() | RouteMarketList */ \"RouteMarketList\").then(__webpack_require__.bind(null, /*! ./MarketList */ \"./src/page/Market/MarketList.tsx\")),\r\n    },\r\n    render(loaded, props) {\r\n        let Component = loaded.MarketList.default;\r\n        return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router_dom__WEBPACK_IMPORTED_MODULE_8__[\"Route\"], Object.assign({}, props, { render: () => react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Component, Object.assign({}, props)) }));\r\n    },\r\n    loading: () => null,\r\n});\r\nconst MarketGoods = react_loadable__WEBPACK_IMPORTED_MODULE_1___default()({\r\n    loader: () => Promise.all(/*! import() | MarketGoods */[__webpack_require__.e(\"vendors~GoodsDetail~MarketGoods~NotificationsList~PreviewImage\"), __webpack_require__.e(\"vendors~Dashboard~MarketGoods\"), __webpack_require__.e(\"PreviewImage\"), __webpack_require__.e(\"MarketGoods\")]).then(__webpack_require__.bind(null, /*! ./MarketGoods */ \"./src/page/Market/MarketGoods.tsx\")),\r\n    loading: () => null,\r\n});\r\nconst useStyles = Object(_material_ui_styles__WEBPACK_IMPORTED_MODULE_3__[\"makeStyles\"])((theme) => ({\r\n    offset: theme.mixins.toolbar,\r\n    profileCard: {\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        justifyContent: \"center\",\r\n        margin: 36,\r\n        padding: 16,\r\n        width: 200,\r\n    },\r\n    title: { flexGrow: 1 },\r\n}));\r\nconst liff = window.liff;\r\nconst Market = ({ match, location, history }) => {\r\n    const classes = useStyles();\r\n    const { csrf, setCsrf, setDense, enQSnackbar, closeSnackbar, _xhrPost, _xhrGet, _isDesktopBrowser, _thousandSeperater, checkSession, getInfo, profileData, setProfileData, handleLogout, setSess, userInfo, setUserInfo, } = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useContext\"])(_AppContext__WEBPACK_IMPORTED_MODULE_7__[\"AppContext\"]);\r\n    const [marketList, setMarketList] = Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useState\"])(null);\r\n    const passingProps = {\r\n        ...Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useContext\"])(_AppContext__WEBPACK_IMPORTED_MODULE_7__[\"AppContext\"]),\r\n        marketList,\r\n        getMarketPlace,\r\n        refreshInfo: getInfo,\r\n    };\r\n    async function getMarketPlace() {\r\n        const res = await _xhrPost({\r\n            csrf,\r\n            url: \"loadusersystem\",\r\n            body: {\r\n                action: \"boardlist\",\r\n                linetoken: profileData && profileData.userId,\r\n                type: \"customer\",\r\n            },\r\n        });\r\n        setCsrf(res.csrf);\r\n        if (\"status\" in res.data &&\r\n            res.data.status === \"this is not user account or have been delete account\") {\r\n            checkSession();\r\n        }\r\n        else {\r\n            setMarketList(res.data);\r\n        }\r\n    }\r\n    function realtimeBoard(list) {\r\n        const socket = socket_io_client__WEBPACK_IMPORTED_MODULE_2___default()(\"https://easyrecycle.ml\", {\r\n            transports: [\"websocket\", \"polling\"],\r\n        });\r\n        socket.on(`boardlist`, (messageNew) => {\r\n            if (messageNew) {\r\n                const { formid, accessremain } = messageNew;\r\n                if (list) {\r\n                    setMarketList(null);\r\n                    const thisList = list;\r\n                    const filtered = thisList.filter((item) => item.formid === formid);\r\n                    filtered[0].accessremain = accessremain;\r\n                    setMarketList(thisList);\r\n                    if (accessremain === 0) {\r\n                        getMarketPlace();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    async function getSess(profile) {\r\n        setSess(null);\r\n        const res = await _xhrPost({\r\n            csrf,\r\n            url: \"session\",\r\n            body: { linetoken: profile.userId, type: \"customer\" },\r\n        });\r\n        setCsrf(res.csrf);\r\n        setSess(res.data);\r\n    }\r\n    async function getMarketInfo(profile) {\r\n        const res = await _xhrPost({\r\n            csrf,\r\n            url: \"loadusersystem\",\r\n            body: {\r\n                action: \"info\",\r\n                linetoken: profile.userId,\r\n                type: \"customer\",\r\n            },\r\n        });\r\n        setCsrf(res.csrf);\r\n        setUserInfo(res.data);\r\n    }\r\n    function getProfile() {\r\n        liff\r\n            .getProfile()\r\n            .then((profile) => {\r\n            setProfileData(profile);\r\n            getSess(profile);\r\n            getMarketInfo(profile);\r\n        })\r\n            .catch((err) => console.error(err));\r\n    }\r\n    function handleFetch() {\r\n        const myLiffId = \"1653861118-DAld6Lv2\"; // customer\r\n        liff.init({ liffId: myLiffId }, async () => {\r\n            if (liff.isLoggedIn()) {\r\n                getProfile();\r\n            }\r\n            else {\r\n                liff.login({\r\n                    redirectUri: \"https://easyrecycle.ml/market\",\r\n                });\r\n            }\r\n        });\r\n    }\r\n    Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useEffect\"])(() => {\r\n        if (profileData) {\r\n            getMarketPlace();\r\n        }\r\n        else {\r\n            handleFetch();\r\n        }\r\n    }, [profileData]);\r\n    Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useEffect\"])(() => {\r\n        realtimeBoard(marketList);\r\n    }, [marketList]);\r\n    Object(react__WEBPACK_IMPORTED_MODULE_0__[\"useEffect\"])(() => {\r\n        // if (_isDesktopBrowser()) {\r\n        //   history.replace(\"/admin\");\r\n        // } else {\r\n        //   setDense(true);\r\n        // }\r\n    }, []);\r\n    return (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_AppContext__WEBPACK_IMPORTED_MODULE_7__[\"AppContext\"].Provider, { value: passingProps },\r\n        react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(\"div\", null,\r\n            react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(MarketHeader, Object.assign({}, { userInfo, handleLogout })),\r\n            react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(\"div\", { className: classes.offset }),\r\n            userInfo && !(\"status\" in userInfo) && (react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(\"div\", { style: {\r\n                    display: \"flex\",\r\n                    padding: \"12px 16px 0 16px\",\r\n                    alignItems: \"center\",\r\n                } },\r\n                react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router_dom__WEBPACK_IMPORTED_MODULE_8__[\"Link\"], { to: \"/\", style: { color: _material_ui_core_colors__WEBPACK_IMPORTED_MODULE_6__[\"green\"][600] } },\r\n                    react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_material_ui_core__WEBPACK_IMPORTED_MODULE_4__[\"Typography\"], { style: { marginRight: 16 }, variant: \"h6\" }, \"\\u0E1A\\u0E31\\u0E0D\\u0E0A\\u0E35\\u0E02\\u0E2D\\u0E07\\u0E09\\u0E31\\u0E19\")),\r\n                react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_material_ui_core__WEBPACK_IMPORTED_MODULE_4__[\"Typography\"], { variant: \"h6\", style: {\r\n                        marginLeft: 24,\r\n                        marginRight: 8,\r\n                        fontWeight: 700,\r\n                        flex: 1,\r\n                    }, align: \"right\" }, _thousandSeperater(userInfo.info.balance)),\r\n                react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_material_ui_icons__WEBPACK_IMPORTED_MODULE_5__[\"AttachMoney\"], null))),\r\n            react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(RouteMarketList, { exact: true, path: match.path }),\r\n            react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router_dom__WEBPACK_IMPORTED_MODULE_8__[\"Route\"], { exact: true, path: `${match.path}/:formid`, component: MarketGoods }))));\r\n};\r\n/* harmony default export */ __webpack_exports__[\"default\"] = (Object(react_router_dom__WEBPACK_IMPORTED_MODULE_8__[\"withRouter\"])((props) => react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(Market, Object.assign({}, props))));\r\n\n\n//# sourceURL=webpack:///./src/page/Market/Market.tsx?");

/***/ }),

/***/ 0:
/*!********************!*\
  !*** ws (ignored) ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/* (ignored) */\n\n//# sourceURL=webpack:///ws_(ignored)?");

/***/ })

}]);